#include "XCmdGlue.h"#include <stdlib.h>#include <stdio.h>#include <string.h>#ifdef MACOS  #define WIN_EXPORT  #ifdef MACHO    #include <QuickTime/QuickTime.h>  #else    #include <Carbon.h>  #endif#else    #define WIN_EXPORT __declspec(dllexport)     #include "Movies.h"#endifvoid XCabort();WIN_EXPORT void QTRotate(char *args[], int nargs, char **retstring, Bool *pass, Bool *error);void XCabort(){  //fprintf(stderr, "external abort");}/**********************************************************************************************//* Table of function and command names to register with Metacard */Xternal Xtable[] = { 	 	{"RotateMovie", XCOMMAND, 0, QTRotate, XCabort},  		{"", XNONE, 0, NULL, NULL}};char Xname[] = "RotateMovie";void QTRotate(char *args[], int nargs, char **retstring, Bool *pass, Bool *error) {	MovieController mc = (MovieController)atol(args[0]);	long			deg = atol(args[1]);	Movie			theMovie;	MatrixRecord	myMatrix;	Rect			r;	FixedPoint		p;	char*			retstr;		if (mc == 0) goto cleanup;		SetIdentityMatrix(&myMatrix);		MCSetControllerAttached(mc, false);		theMovie = MCGetMovie(mc);	GetMovieBox(theMovie, &r);		RotateMatrix(&myMatrix, Long2Fix(deg), r.left, r.top);	//TranslateMatrix(&myMatrix, Long2Fix(r.right), Long2Fix(0));					SetMovieMatrix(theMovie, &myMatrix);		GetMovieBox(theMovie, &r);		MCSetControllerBoundsRect(mc, &r);		MCSetControllerAttached(mc, true);		retstr = (char*)malloc(32);	sprintf(retstr, "%d,%d,%d,%d", r.left, r.top, r.right, r.bottom);		cleanup:		*error = false;	*pass = false;		if (retstr == NULL) retstr = (char*)calloc(1,1);	 	*retstring = (char*)calloc(strlen(retstr) + 1 ,1);		BlockMoveData(retstr, *retstring, strlen(retstr));		free(retstr);}